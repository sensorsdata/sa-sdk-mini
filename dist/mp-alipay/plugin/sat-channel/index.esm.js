var sa,customEventList=[],maxSaveTime=2592e6,latestEventInitialTime=null;function decodeURI(e){var t='';try{t=decodeURIComponent(e)}catch(n){t=e}return t}function getQueryString(e,t){if(e[t])return decodeURI(e[t]);var n=e.scene||'';if(n){var a=decodeURI(n),i=new RegExp('(^|&)'+t+'=([^&]*)(&|$)','i'),s=a.match(i);if(null!==s)return decodeURI(s[2])}return null}function isSatCfLegal(e){return''!==e&&'\'\''!==e&&'""'!==e}var SATChannel={plugin_name:'SATChannel',init:function(e){if(!(sa=e))return console.log('\u5f53\u524d\u4e3bsdk \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684 sensors \u5bf9\u8c61\uff01'),!1;this.eventList.init(),this.listenAppLaunch(sa),this.addIsChannelCallbackEvent()},getChannelQuery:function(e){var t=sa._.deepCopy(e).query;if(sa._.isObject(t)){var n=getQueryString(t,'sat_cf'),a=isSatCfLegal(n);if(n&&a){var i={},s=t.scene||'',r='';s&&(r=decodeURI(s),delete t.scene);var l=sa._.setQuery(t),c=sa._.setQuery(t,!0);if(r&&(l+=(l?'&':'')+r,c+=(c?'&':'')+r),e.path){i.$url_path=sa._.getPath(e.path);var u=l?'?'+l:'',o=c?'?'+c:'';i.$url=i.$url_path+u,i.$ad_landing_page_url=i.$url_path+o}t._sfs&&(i.$sf_source=t._sfs,i.$latest_sf_source=i.$sf_source);var v=sa._.setUtm(e,i);sa._.setLatestChannel(v.pre2),i.$latest_scene=i.$scene,i.$url_query=l,this.trackChannel(i)}}},trackChannel:function(e){sa.track('$ChannelLinkReaching',e)},addIsChannelCallbackEvent:function(){var e=this,t=['$MPLaunch','$ABTestTrigger','$PlanPopupDisplay','$PlanPopupClick','$ChannelLinkReaching','$MPShow','$MPHide','$MPViewScreen','$MPClick','$MPShare','$MPAddFavorites','$MPPageLeave','$SignUp','$UnbindID','$BindID'];sa.registerPropertyPlugin({properties:function(n){if(n&&n.event){var a=n.event,i=!0;t.indexOf(a)<0&&(e.eventList.hasEvent(a)?i=!1:e.eventList.add(a),n.properties.$is_channel_callback_event=i)}}})},eventList:{init:function(){var e=sa.system_api.getStorageSync('saminiprogramchannel'),t=(new Date).getTime();if(e&&sa._.isNumber(e.latest_event_initial_time)&&sa._.isArray(e.event_list)){var n=t-e.latest_event_initial_time;n>0&&n<maxSaveTime?(customEventList=e.event_list,latestEventInitialTime=e.latest_event_initial_time):this.reset()}else this.reset()},add:function(e){customEventList.push(e),this.save()},save:function(){var e={event_list:customEventList,latest_event_initial_time:latestEventInitialTime};sa.system_api.setStorageSync('saminiprogramchannel',e)},reset:function(){customEventList=[],latestEventInitialTime=(new Date).getTime(),this.save()},hasEvent:function(e){var t=!1;return sa._.each(customEventList,function(n){n===e&&(t=!0)}),t}},listenAppLaunch:(function(e){var t=e.platform_obj.getLaunchOptionsSync()||{};t&&SATChannel.getChannelQuery(t)},function(e){var t=!0;e.platform_obj.onAppShow(function(n){t&&(e.platform_obj.getLaunchOptionsSync(),t=!1,SATChannel.getChannelQuery(n))})})};export default SATChannel;