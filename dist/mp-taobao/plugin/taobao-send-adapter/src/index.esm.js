const _toString=Object.prototype.toString,_isArray=Array.prototype.isArray;function isArray(a){return _isArray||'[object Array]'===_toString.call(a)}function utf8Encode(a){var t,e,n,o,c='';for(t=e=0,n=(a=(a+'').replace(/\r\n/g,'\n').replace(/\r/g,'\n')).length,o=0;o<n;o++){var s=a.charCodeAt(o),i=null;s<128?e++:i=s>127&&s<2048?String.fromCharCode(s>>6|192,63&s|128):String.fromCharCode(s>>12|224,s>>6&63|128,63&s|128),null!==i&&(e>t&&(c+=a.substring(t,e)),c+=i,t=e=o+1)}return e>t&&(c+=a.substring(t,a.length)),c}function base64Encode(a){var t,e,n,o,c,s='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=',i=0,r=0,d='',u=[];if(!a)return a;a=utf8Encode(a);do{t=(c=a.charCodeAt(i++)<<16|a.charCodeAt(i++)<<8|a.charCodeAt(i++))>>18&63,e=c>>12&63,n=c>>6&63,o=63&c,u[r++]=s.charAt(t)+s.charAt(e)+s.charAt(n)+s.charAt(o)}while(i<a.length);switch(d=u.join(''),a.length%3){case 1:d=d.slice(0,-2)+'==';break;case 2:d=d.slice(0,-1)+'='}return d}var sa,getRandomBasic=function(){var a=(new Date).getTime();return function(t){return Math.ceil((a=(9301*a+49297)%233280)/233280*t)}}(),tbConfig={cloudFuncSend:!1,cloudFuncName:'httpTunnel',cloudFuncHandler:'main',cloudAppId:'',path:'',exts:{}},cloudFuncInvoke=function(a){var t={data:a.data};sa&&sa.para&&sa.para.batch_send&&(t={data_list:a.data}),getApp()&&getApp().cloud&&getApp().cloud.function&&getApp().cloud.function.invoke?getApp().cloud.function.invoke(tbConfig.cloudFuncName,t,tbConfig.cloudFuncHandler).then(t=>{t&&t.success?a.success&&a.success():a.fail&&a.fail()}).catch(t=>{sa.log('\u6570\u636e\u53d1\u9001\u5931\u8d25!'+JSON.stringify(t)),a.fail&&a.fail()}):sa.log('\u8bf7\u6c42\u5931\u8d25!\u5f53\u524d\u5e94\u7528\u4e0d\u652f\u6301\u6dd8\u5b9d\u4e91\u51fd\u6570!')},cloudAppInvoke=function(a){if(getApp()&&getApp().cloud&&getApp().cloud.application&&getApp().cloud.application.httpRequest){var t={path:tbConfig.path,headers:{'Content-Type':'application/json;charset=UTF-8'},exts:sa._.extend({},{cloudAppId:tbConfig.cloudAppId},tbConfig.exts)};if(sa&&sa.para&&sa.para.batch_send)t.method='POST',t.body={data_list:a.data};else{t.method='GET';var e=tbConfig.path,n=e+"?data="+a.data;-1!==e.indexOf('?')&&(n=e+"&data="+a.data),t.path=n}getApp().cloud.application.httpRequest(t).then(t=>{t&&t.success?a.success&&a.success():a.fail&&a.fail()}).catch(t=>{sa.log('\u6570\u636e\u53d1\u9001\u5931\u8d25!'+JSON.stringify(t)),a.fail&&a.fail()})}else sa.log('\u8bf7\u6c42\u5931\u8d25!\u5f53\u524d\u5e94\u7528\u4e0d\u652f\u6301\u6dd8\u5b9d\u4e91\u5e94\u7528!')},onceSend=function(a){var t=cloudAppInvoke;tbConfig.cloudFuncSend&&(t=cloudFuncInvoke),a._flush_time=Date.now();var e=JSON.stringify(a);t({data:encodeURIComponent(base64Encode(e))})},batchRequest=function(a){var t=cloudAppInvoke;if(tbConfig.cloudFuncSend&&(t=cloudFuncInvoke),isArray(a.data)&&a.data.length>0){var e=Date.now();a.data.forEach(function(a){a._flush_time=e}),a.data=JSON.stringify(a.data),t({data:encodeURIComponent(base64Encode(a.data)),success:function(){a.success(a.len)},fail:function(){a.fail()}})}else a.success(a.len)},TaobaoSendAdapter={name:'TaobaoSendAdapter',init:function(a,t={}){if(!(sa=a))return console.log('\u5f53\u524d\u4e3bsdk \u521d\u59cb\u5316\u5931\u8d25\uff0c\u8bf7\u4f20\u5165\u6b63\u786e\u7684 sensors \u5bf9\u8c61\uff01'),!1;tbConfig=Object.assign(tbConfig,t),sa.kit&&(sa.kit.batchRequest=batchRequest,sa.kit.onceSend=onceSend,sa.para.show_log&&sa.log('[sensorsData]\uff1aTaobaoSendAdapter \u63d2\u4ef6\u521d\u59cb\u5316\u5b8c\u6210\uff01'))}};export default TaobaoSendAdapter;